<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CineStream Infinity | Premium Streaming</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        :root { --accent: #e50914; --bg: #030303; }
        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            background-color: var(--bg); 
            color: white; 
            scroll-behavior: smooth;
            -webkit-tap-highlight-color: transparent;
        }
        .glass { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(15px); border: 1px solid rgba(255, 255, 255, 0.05); }
        .glass-dark { background: rgba(0, 0, 0, 0.95); backdrop-filter: blur(25px); border-bottom: 1px solid rgba(255, 255, 255, 0.05); }
        .movie-card { transition: transform 0.3s ease; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        
        /* Pagination */
        .pagination-btn { @apply min-w-[48px] h-[48px] rounded-2xl flex items-center justify-center font-bold transition-all duration-300 glass hover:bg-white/10 text-sm; }
        .pagination-btn.active { @apply bg-red-600 text-white border-none shadow-lg shadow-red-900/40; }
        
        /* Android Friendly Modern Buttons */
        .server-btn-android {
            @apply w-full h-[54px] rounded-2xl flex items-center justify-center gap-3 font-bold text-xs uppercase tracking-widest transition-all duration-300 border border-white/10 glass text-gray-400 active:scale-95;
        }
        .server-btn-android.active {
            @apply bg-red-600 text-white border-none shadow-[0_8px_20px_rgba(229,9,20,0.4)];
        }

        /* Mini Player Logic */
        #player-view.mini {
            @apply fixed bottom-4 right-4 w-[260px] md:w-[400px] z-[200] pt-0 px-0 pb-0 shadow-2xl transition-all duration-500 ease-in-out border border-white/10 rounded-2xl overflow-hidden bg-black;
        }
        #player-view.mini .lg:col-span-3 { @apply space-y-0; }
        #player-view.mini .player-container { @apply rounded-none ring-0 border-none shadow-none; }
        #player-view.mini .meta-data, 
        #player-view.mini .sidebar-section,
        #player-view.mini .back-btn,
        #player-view.mini .server-section { @apply hidden; }
        
        #player-view.mini #close-mini { @apply block; }
        #close-mini { @apply hidden absolute top-2 right-2 z-[210] glass p-2 rounded-full bg-red-600/80 backdrop-blur-md; }

        #home-view, #player-view { transition: opacity 0.3s ease; }
    </style>
</head>
<body class="overflow-x-hidden">

    <!-- Global Navigation -->
    <nav class="fixed top-0 w-full z-[100] px-4 md:px-6 py-4 flex items-center justify-between transition-all duration-500" id="navbar">
        <div class="flex items-center gap-4 md:gap-10">
            <div class="flex items-center gap-2 cursor-pointer" onclick="clearSearchAndHome()">
                <div class="w-10 h-10 bg-red-600 rounded-xl flex items-center justify-center font-black text-xl italic shadow-lg shadow-red-900/20">C</div>
                <span class="text-xl font-extrabold tracking-tighter hidden xs:block uppercase">CINE<span class="text-red-600">INFINITY</span></span>
            </div>
            <div class="flex gap-4 md:gap-8 text-[10px] md:text-xs font-bold uppercase tracking-widest text-gray-400">
                <a href="#" class="hover:text-white transition" onclick="clearSearchAndHome()">Home</a>
                <a href="#" class="text-red-500 hover:text-red-400 transition" onclick="setHindiMode()">Hindi</a>
            </div>
        </div>
        <div class="flex items-center gap-2">
            <div class="glass rounded-xl px-3 py-2 flex items-center gap-2">
                <svg class="w-4 h-4 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                <input type="text" id="search-input" placeholder="Search..." onkeypress="handleSearch(event)" class="bg-transparent border-none outline-none text-xs w-20 md:w-44 placeholder-gray-600">
            </div>
        </div>
    </nav>

    <!-- HOME VIEW -->
    <div id="home-view" class="pt-24 pb-12 px-4 md:px-12 space-y-12">
        <!-- Latest Section -->
        <section id="trending-section">
            <div class="flex items-center justify-between mb-6 px-1">
                <h2 class="text-2xl md:text-3xl font-extrabold tracking-tight italic uppercase text-white/90">LATEST <span class="text-red-600 font-black">PREMIERES</span></h2>
                <div class="hidden md:flex gap-3">
                    <button onclick="scrollRow('latest-row', -500)" class="w-11 h-11 glass rounded-2xl flex items-center justify-center hover:bg-white/10 transition text-white">←</button>
                    <button onclick="scrollRow('latest-row', 500)" class="w-11 h-11 glass rounded-2xl flex items-center justify-center hover:bg-white/10 transition text-white">→</button>
                </div>
            </div>
            <div id="latest-row" class="flex gap-4 md:gap-6 overflow-x-auto hide-scrollbar scroll-smooth pb-4 -mx-4 px-4 md:mx-0 md:px-0 text-white"></div>
        </section>

        <!-- Library Section -->
        <section id="catalog-section">
            <div class="mb-8 flex flex-col md:flex-row md:items-end justify-between gap-4 px-1">
                <div>
                    <h2 id="catalog-title" class="text-2xl md:text-3xl font-extrabold tracking-tight uppercase italic text-white">GLOBAL <span class="text-red-600">LIBRARY</span></h2>
                    <div class="h-1 w-12 bg-red-600 mt-2 rounded-full"></div>
                </div>
                <div class="flex items-center gap-4">
                    <button id="clear-search-btn" onclick="clearSearchAndHome()" class="hidden text-[10px] font-bold text-red-500 uppercase tracking-widest hover:underline">Clear Search</button>
                    <span class="text-[9px] font-bold text-gray-500 uppercase tracking-widest hidden sm:block">40 Items Per Page</span>
                </div>
            </div>
            <div id="catalog-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 xl:grid-cols-8 gap-4 md:gap-6 min-h-[50vh]"></div>
            <div id="pagination-container" class="mt-16 flex flex-wrap items-center justify-center gap-2"></div>
        </section>
    </div>

    <!-- PLAYER VIEW -->
    <div id="player-view" class="hidden pt-24 px-4 md:px-12 pb-12">
        <!-- PiP Close Button -->
        <button id="close-mini" onclick="stopPlayer()">
            <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
        </button>

        <div class="max-w-[1440px] mx-auto">
            <button onclick="switchView('home')" class="back-btn flex items-center gap-2 text-gray-500 hover:text-white transition mb-6 text-[10px] font-black uppercase tracking-widest">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M15 19l-7-7 7-7" stroke-width="3"/></svg>
                Return to Gallery
            </button>

            <div class="grid lg:grid-cols-4 gap-8 md:gap-12">
                <div class="lg:col-span-3 space-y-8 md:space-y-10">
                    <!-- Player -->
                    <div class="player-container relative aspect-video bg-black rounded-2xl md:rounded-[2.5rem] overflow-hidden shadow-2xl border border-white/5 shadow-red-900/10">
                        <iframe id="video-frame" class="w-full h-full" src="" frameborder="0" allowfullscreen></iframe>
                        <div id="loader" class="absolute inset-0 bg-zinc-950 flex flex-col items-center justify-center gap-4 hidden">
                            <div class="w-10 h-10 border-4 border-red-600 border-t-transparent rounded-full animate-spin"></div>
                            <span class="text-[9px] font-bold tracking-widest text-gray-500 uppercase">Fetching Stream...</span>
                        </div>
                    </div>

                    <!-- Clean Android Server Buttons -->
                    <div class="server-section space-y-4 px-1">
                        <div class="flex items-center justify-between">
                            <h4 class="text-[11px] font-black text-gray-400 uppercase tracking-widest">Switch Server</h4>
                            <div class="flex items-center gap-1.5 bg-green-500/10 px-2.5 py-1 rounded-full">
                                <span class="w-1.5 h-1.5 rounded-full bg-green-500 animate-pulse"></span>
                                <span class="text-[9px] font-bold text-green-500 uppercase">Servers Online</span>
                            </div>
                        </div>
                        <div class="grid grid-cols-2 sm:grid-cols-4 gap-3" id="server-list"></div>
                    </div>

                    <div class="meta-data space-y-4 px-2">
                        <h1 id="p-title" class="text-3xl md:text-5xl font-extrabold tracking-tighter italic uppercase text-white leading-tight">MOVIE TITLE</h1>
                        <div class="flex items-center gap-4 text-xs font-semibold">
                            <span class="text-red-500 font-black" id="p-rating">IMDB 8.5</span>
                            <span class="text-gray-400" id="p-year">2024</span>
                            <span class="glass px-2.5 py-1 rounded-lg text-[9px] uppercase text-white/40 tracking-widest font-bold italic">Hindi / Multi-Audio</span>
                        </div>
                        <p id="p-desc" class="text-gray-400 text-sm md:text-lg leading-relaxed max-w-4xl font-light italic"></p>
                    </div>
                </div>
                <div class="sidebar-section space-y-6">
                    <h3 class="text-[10px] font-black uppercase tracking-[0.2em] text-gray-600 ml-1 italic">Up Next</h3>
                    <div id="sidebar-list" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-1 gap-4"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_KEY = "dc691868b09daaabe9acc238ed898cf7";
        const IMG_URL = "https://image.tmdb.org/t/p/w500";
        let currentPage = 1, currentMovieId = null, searchQuery = "", hindiMode = false, isPlaying = false;

        const providers = [
            { id: 'vidsrcto', name: 'Server Alpha', url: (id) => `https://vidsrc.to/embed/movie/${id}` },
            { id: 'vidsrcme', name: 'Server Beta', url: (id) => `https://vidsrc.me/embed/movie?tmdb=${id}` },
            { id: '2embed', name: 'Server Gamma', url: (id) => `https://www.2embed.cc/embed/${id}` },
            { id: 'autoembed', name: 'Server Delta', url: (id) => `https://autoembed.to/movie/tmdb/${id}` }
        ];

        async function api(path, params = {}) {
            const query = new URLSearchParams({ api_key: API_KEY, ...params });
            try { return await (await fetch(`https://api.themoviedb.org/3/${path}?${query}`)).json(); } catch(e) { return null; }
        }

        async function init() {
            const data = await api('movie/now_playing');
            if (data) document.getElementById('latest-row').innerHTML = data.results.map(m => card(m, true)).join('');
            render(1);
        }

        async function render(page) {
            currentPage = page;
            const grid = document.getElementById('catalog-grid'), title = document.getElementById('catalog-title'), clear = document.getElementById('clear-search-btn'), trending = document.getElementById('trending-section');
            let movies = [];
            const p1 = (page * 2) - 1, p2 = page * 2;

            if (searchQuery) {
                title.innerHTML = `Search: <span class="text-red-600">${searchQuery.toUpperCase()}</span>`;
                clear.classList.remove('hidden'); trending.classList.add('hidden');
                const [r1, r2] = await Promise.all([api('search/movie', { query: searchQuery, page: p1 }), api('search/movie', { query: searchQuery, page: p2 })]);
                movies = [...(r1?.results || []), ...(r2?.results || [])];
            } else if (hindiMode) {
                title.innerHTML = `Hindi <span class="text-red-600">Dubbed</span>`;
                clear.classList.remove('hidden'); trending.classList.add('hidden');
                const [r1, r2] = await Promise.all([api('discover/movie', { with_original_language: 'hi', page: p1, sort_by: 'popularity.desc' }), api('discover/movie', { with_original_language: 'hi', page: p2, sort_by: 'popularity.desc' })]);
                movies = [...(r1?.results || []), ...(r2?.results || [])];
            } else {
                title.innerHTML = `Global <span class="text-red-600">Library</span>`;
                clear.classList.add('hidden'); trending.classList.remove('hidden');
                const [r1, r2] = await Promise.all([api('movie/popular', { page: p1 }), api('movie/popular', { page: p2 })]);
                movies = [...(r1?.results || []), ...(r2?.results || [])];
            }
            grid.innerHTML = movies.length ? movies.map(m => card(m)).join('') : `<div class="col-span-full py-20 text-center text-gray-500 uppercase font-black italic tracking-widest">No Content Found</div>`;
            pagination();
            if(page > 1) window.scrollTo({ top: document.getElementById('catalog-section').offsetTop - 100, behavior: 'smooth' });
        }

        function card(m, wide = false) {
            if(!m.poster_path && !m.backdrop_path) return '';
            const path = wide ? (m.backdrop_path || m.poster_path) : (m.poster_path || m.backdrop_path);
            return `<div class="movie-card group cursor-pointer" onclick="play(${m.id})"><div class="relative ${wide ? 'w-48 md:w-64 aspect-[16/9]' : 'aspect-[2/3]'} rounded-xl md:rounded-[2rem] overflow-hidden bg-zinc-900 border border-white/5"><img src="${IMG_URL + path}" class="w-full h-full object-cover group-hover:scale-105 transition duration-500" loading="lazy"><div class="absolute inset-0 bg-gradient-to-t from-black/80 via-transparent to-transparent"></div><div class="absolute inset-0 p-3 flex flex-col justify-end opacity-0 group-hover:opacity-100 transition-all duration-300 bg-black/40 backdrop-blur-[2px]"><h4 class="font-bold text-[10px] md:text-xs truncate uppercase tracking-tight italic text-white">${m.title}</h4><div class="flex items-center gap-2 mt-1"><div class="w-6 h-6 rounded-full bg-red-600 flex items-center justify-center"><svg class="w-3 h-3 text-white" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg></div><span class="text-[9px] font-bold text-gray-300">${m.release_date ? m.release_date.split('-')[0] : ''}</span></div></div></div></div>`;
        }

        function pagination() {
            const container = document.getElementById('pagination-container'), range = 2;
            let btns = '', start = Math.max(1, currentPage - range), end = start + 4;
            if(currentPage > 1) btns += `<button onclick="render(${currentPage - 1})" class="pagination-btn">PREV</button>`;
            for(let i = start; i <= end; i++) btns += `<button onclick="render(${i})" class="pagination-btn ${currentPage === i ? 'active' : ''}">${i}</button>`;
            btns += `<button onclick="render(${currentPage + 1})" class="pagination-btn">NEXT</button>`;
            container.innerHTML = btns;
        }

        function handleSearch(e) { if (e.key === "Enter") { searchQuery = e.target.value.trim(); if (searchQuery) { hindiMode = false; switchView('home'); render(1); e.target.blur(); } } }
        function setHindiMode() { hindiMode = true; searchQuery = ""; switchView('home'); render(1); }
        function clearSearchAndHome() { searchQuery = ""; hindiMode = false; document.getElementById('search-input').value = ""; switchView('home'); render(1); }

        function switchView(v) {
            const h = document.getElementById('home-view'), p = document.getElementById('player-view'), n = document.getElementById('navbar');
            if(v === 'home') {
                if (isPlaying) {
                    p.classList.remove('hidden'); p.classList.add('mini');
                    h.classList.remove('hidden'); n.classList.remove('glass-dark');
                } else {
                    p.classList.add('hidden'); h.classList.remove('hidden');
                    n.classList.remove('glass-dark');
                }
            } else {
                h.classList.add('hidden');
                p.classList.remove('hidden', 'mini');
                n.classList.add('glass-dark');
                window.scrollTo(0,0);
            }
        }

        async function play(id) {
            currentMovieId = id; isPlaying = true;
            const m = await api(`movie/${id}`);
            if (!m) return;
            document.getElementById('p-title').innerText = m.title.toUpperCase();
            document.getElementById('p-desc').innerText = m.overview;
            document.getElementById('p-year').innerText = m.release_date ? m.release_date.split('-')[0] : '';
            document.getElementById('p-rating').innerText = `IMDB ${m.vote_average.toFixed(1)}`;
            servers();
            setSrv(providers[0].id);
            sidebar();
            switchView('player');
        }

        function stopPlayer() {
            isPlaying = false; document.getElementById('video-frame').src = "";
            document.getElementById('player-view').classList.add('hidden');
            document.getElementById('player-view').classList.remove('mini');
        }

        function servers() {
            document.getElementById('server-list').innerHTML = providers.map(p => `
                <button id="srv-${p.id}" onclick="setSrv('${p.id}')" class="server-btn-android">
                    ${p.name}
                </button>
            `).join('');
        }

        function setSrv(sid) {
            const s = providers.find(p => p.id === sid), f = document.getElementById('video-frame'), l = document.getElementById('loader');
            document.querySelectorAll('.server-btn-android').forEach(b => b.classList.remove('active'));
            document.getElementById(`srv-${sid}`).classList.add('active');
            l.classList.remove('hidden'); f.src = s.url(currentMovieId);
            const t = setTimeout(() => l.classList.add('hidden'), 4000);
            f.onload = () => { clearTimeout(t); l.classList.add('hidden'); };
        }

        async function sidebar() {
            const d = await api('movie/popular', { page: Math.floor(Math.random() * 5) + 1 });
            if (d) document.getElementById('sidebar-list').innerHTML = d.results.slice(0, 6).map(m => `<div class="flex gap-3 group cursor-pointer p-2 glass rounded-2xl" onclick="play(${m.id})"><div class="w-24 h-16 rounded-xl overflow-hidden flex-shrink-0"><img src="${IMG_URL + m.backdrop_path}" class="w-full h-full object-cover opacity-80 group-hover:opacity-100 transition"></div><div class="flex flex-col justify-center min-w-0"><h5 class="text-[10px] font-black group-hover:text-red-500 transition truncate uppercase tracking-tight italic text-white/90">${m.title}</h5><p class="text-[9px] text-gray-500 font-bold mt-1">${m.release_date ? m.release_date.split('-')[0] : ''}</p></div></div>`).join('');
        }

        function scrollRow(id, d) { document.getElementById(id).scrollLeft += d; }
        window.onload = init;
        window.addEventListener('scroll', () => { const n = document.getElementById('navbar'); if (window.scrollY > 50) n.classList.add('glass-dark', 'py-3'); else n.classList.remove('glass-dark', 'py-3'); });
    </script>
</body>
</html>
